<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mint Your Meme Coin - MemeMinter.fun</title>
    <script type="module">
        import { Connection, PublicKey, Transaction, LAMPORTS_PER_SOL } from "https://cdn.jsdelivr.net/npm/@solana/web3.js/+esm";
        import { createMint, getOrCreateAssociatedTokenAccount, mintTo, TOKEN_PROGRAM_ID } from "https://unpkg.com/@solana/spl-token@0.2.0/lib/umd/spl-token.min.js";

        let walletAddress = null;
        const connection = new Connection("https://api.devnet.solana.com", "confirmed");

        async function connectWallet() {
            if (window.solana && window.solana.isPhantom) {
                try {
                    const response = await window.solana.connect();
                    walletAddress = response.publicKey.toString();
                    document.getElementById("wallet-status").innerText = `Connected: ${walletAddress}`;
                } catch (err) {
                    if (err.message.includes("User rejected the request")) {
                        alert("‚ùå Wallet connection was rejected. Please try again.");
                    } else {
                        alert("‚ùå Wallet connection failed. See console for details.");
                        console.error("Wallet connection failed", err);
                    }
                }
            } else {
                alert("‚ùå Please install Phantom Wallet.");
            }
        }

        window.connectWallet = connectWallet;

        window.mintToken = async function(event) {
            event.preventDefault();

            if (!walletAddress) {
                alert("‚ùå Please connect your Phantom Wallet first!");
                return;
            }

            const tokenName = document.getElementById("token-name").value;
            const tokenSymbol = document.getElementById("token-symbol").value;
            const totalSupply = parseInt(document.getElementById("total-supply").value);

            alert("üöÄ Minting Token... (This may take a few seconds)");

            try {
                const payer = window.solana.publicKey;
                const mint = await createMint(connection, window.solana, payer, null, 0);
                const associatedTokenAccount = await getOrCreateAssociatedTokenAccount(connection, window.solana, mint, payer);
                const signature = await mintTo(connection, window.solana, mint, associatedTokenAccount.address, payer, totalSupply);

                alert(`üéâ Token Minted Successfully! Transaction: ${signature}`);
            } catch (err) {
                console.error("Minting failed", err);
                alert("‚ùå Minting failed. Check console for details.");
            }
        }
    </script>
    <style>
        /* CSS still the same */
    </style>
</head>
<body>
    <div class="container">
        <h1>Mint Your Meme Coin</h1>
        <p>Create your own meme coin in just a few simple steps!</p>

        <button class="wallet-button" onclick="connectWallet()">üîó Connect Phantom Wallet</button>
        <p id="wallet-status">Not Connected</p>

        <form id="mint-form" onsubmit="mintToken(event)">
            <label for="token-name">Token Name:</label>
            <input type="text" id="token-name" placeholder="Enter token name" required>

            <label for="token-symbol">Token Symbol:</label>
            <input type="text" id="token-symbol" placeholder="Enter token symbol" required>

            <label for="total-supply">Total Supply:</label>
            <input type="number" id="total-supply" placeholder="Enter total supply" required>

            <button type="submit" class="mint-button">üöÄ Mint Token</button>
        </form>

        <a class="back-home" href="index.html">‚¨Ö Back to Home</a>
    </div>
</body>
</html>
