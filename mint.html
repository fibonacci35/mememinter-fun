<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mint Your Meme Coin - MemeMinter.fun</title>

    <script defer src="https://unpkg.com/@solana/web3.js@1.76.0/lib/index.iife.min.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/buffer/6.0.3/buffer.min.js"></script>
    <script defer src="https://unpkg.com/@solana/spl-token@0.3.7/lib/index.iife.min.js"></script>

    <script defer>
        window.Buffer = window.Buffer || require("buffer").Buffer;

        let walletAddress = null;
        let connection = null;

        document.addEventListener("DOMContentLoaded", function() {
            if (typeof solanaWeb3 !== "undefined" && typeof splToken !== "undefined") {
                connection = new solanaWeb3.Connection("https://api.devnet.solana.com", "confirmed");
                console.log("‚úÖ Solana Web3.js ve SPL Token y√ºklendi!");
            } else {
                console.error("‚ùå Solana Web3.js veya SPL Token y√ºklenemedi.");
            }
        });

        async function connectWallet() {
            try {
                if (!window.solana || !window.solana.isPhantom) {
                    alert("‚ùå Please install Phantom Wallet.");
                    return;
                }

                const response = await window.solana.connect();
                walletAddress = response.publicKey.toString();
                document.getElementById("wallet-status").innerText = `Connected: ${walletAddress}`;
                console.log("‚úÖ Wallet Connected:", walletAddress);
            } catch (err) {
                alert("‚ùå Wallet connection failed. Check console for details.");
                console.error("Wallet connection failed", err);
            }
        }

        async function mintToken(event) {
            event.preventDefault();

            if (!walletAddress) {
                alert("‚ùå Please connect your Phantom Wallet first!");
                return;
            }

            const tokenName = document.getElementById("token-name").value;
            const tokenSymbol = document.getElementById("token-symbol").value;
            const totalSupply = parseInt(document.getElementById("total-supply").value);

            alert(`üöÄ Minting ${totalSupply} ${tokenSymbol} Token... Please approve the transaction in Phantom Wallet.`);

            try {
                const payer = solanaWeb3.Keypair.generate(); // Mint yetkisi i√ßin ge√ßici keypair.
                const mintAuthority = payer;
                const freezeAuthority = null;
                const decimals = 0; // Ondalƒ±k hane sayƒ±sƒ±

                const mint = await splToken.createMint(
                    connection,
                    payer,
                    mintAuthority.publicKey,
                    freezeAuthority,
                    decimals
                );

                const tokenAccount = await splToken.getOrCreateAssociatedTokenAccount(
                    connection,
                    payer,
                    mint,
                    new solanaWeb3.PublicKey(walletAddress)
                );

                await splToken.mintTo(
                    connection,
                    payer,
                    mint,
                    tokenAccount.address,
                    mintAuthority,
                    totalSupply
                );

                alert(`üéâ ${totalSupply} ${tokenSymbol} Token Minted Successfully!`);
                console.log("‚úÖ Token Minted");
            } catch (err) {
                console.error("‚ùå Minting failed", err);
                alert("‚ùå Minting failed. Check console for details.");
            }
        }

        window.onload = function() {
            document.getElementById("connect-wallet").onclick = connectWallet;
            document.getElementById("mint-form").onsubmit = mintToken;
        };
    </script>

    <style>
        /* CSS stilleri aynƒ± kalƒ±r */
    </style>
</head>
<body>
    <div class="container">
        <h1>Mint Your Meme Coin</h1>
        <p>Create your own meme coin in just a few simple steps!</p>

        <button class="wallet-button" id="connect-wallet">üîó Connect Phantom Wallet</button>
        <p id="wallet-status">Not Connected</p>

        <form id="mint-form">
            <label for="token-name">Token Name:</label>
            <input type="text" id="token-name" placeholder="Enter token name" required>

            <label for="token-symbol">Token Symbol:</label>
            <input type="text" id="token-symbol" placeholder="Enter token symbol" required>

            <label for="total-supply">Total Supply:</label>
            <input type="number" id="total-supply" placeholder="Enter total supply" required>

            <button type="submit" class="mint-button">üöÄ Mint Token</button>
        </form>

        <a class="back-home" href="index.html">‚¨Ö Back to Home</a>
    </div>
</body>
</html>
