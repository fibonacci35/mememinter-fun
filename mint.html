<script type="module">
    import { Connection, PublicKey, Transaction, SystemProgram } from "https://cdn.jsdelivr.net/npm/@solana/web3.js/+esm";

    let walletAddress = null; // Sadece bir kez tanƒ±mlandƒ± ‚úÖ
    const connection = new Connection("https://api.devnet.solana.com", "confirmed");

    window.connectWallet = async function() {
        if (window.solana && window.solana.isPhantom) {
            try {
                const response = await window.solana.connect();
                walletAddress = response.publicKey.toString();
                document.getElementById("wallet-status").innerText = `Connected: ${walletAddress}`;
            } catch (err) {
                if (err.message.includes("User rejected the request")) {
                    alert("‚ùå Wallet connection was rejected. Please try again.");
                } else {
                    alert("‚ùå Wallet connection failed. Check console for details.");
                    console.error("Wallet connection failed", err);
                }
            }
        } else {
            alert("‚ùå Please install Phantom Wallet.");
        }
    }

    window.mintToken = async function(event) {
        event.preventDefault();

        if (!walletAddress) {
            alert("‚ùå Please connect your Phantom Wallet first!");
            return;
        }

        alert("üöÄ Minting Token... (This may take a few seconds)");

        try {
            const transaction = new Transaction().add(
                SystemProgram.transfer({
                    fromPubkey: new PublicKey(walletAddress),
                    toPubkey: new PublicKey(walletAddress),
                    lamports: 1000000, // 0.01 SOL
                })
            );

            const signature = await window.solana.signAndSendTransaction(transaction);
            await connection.confirmTransaction(signature);

            alert("üéâ Token Minted Successfully! Transaction: " + signature);
        } catch (err) {
            console.error("Minting failed", err);
            alert("‚ùå Minting failed. Check console for details.");
        }
    }
</script>
